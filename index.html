<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waveform Visualizer</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <style>
        canvas {
            display: block;
            width: 100%;
            height: 150px;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-5 text-center">Waveform Visualizer</h1>
        <div class="custom-file mt-4">
            <input type="file" class="custom-file-input" id="fileInput" accept=".wav">
            <label class="custom-file-label" for="fileInput">Choose WAV File</label>
        </div>
        <canvas id="waveformCanvas"></canvas>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('fileInput');
            const canvas = document.getElementById('waveformCanvas');
            const context = canvas.getContext('2d');

            // Set canvas dimensions in terms of device pixels
            const devicePixelRatio = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * devicePixelRatio;
            canvas.height = rect.height * devicePixelRatio;
            context.scale(devicePixelRatio, devicePixelRatio);
          
            fileInput.addEventListener('change', handleFile, false);
          
            function handleFile(event) {
                const file = event.target.files[0];
              
                if (file.type && file.type.includes('audio')) {
                    const reader = new FileReader();
                  
                    reader.onload = function (e) {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                      
                        audioContext.decodeAudioData(e.target.result, function (buffer) {
                            drawWaveform(buffer);
                        });
                    };
                  
                    reader.readAsArrayBuffer(file);
                } else {
                    alert('Please choose an audio file.');    
                }
            }
          
            function drawWaveform(buffer) {
                const data = buffer.getChannelData(0);
                const width = canvas.width;
                const height = canvas.height;
                const step = Math.ceil(data.length / width);
                const amp = height / 2;
              
                context.clearRect(0, 0, width, height);
                context.beginPath();
                context.moveTo(0, amp);
                
                context.strokeStyle = 'red'; // Set the stroke color to red
                
                for (let i = 0; i < width; i++) {
                    let min = 1.0;
                    let max = -1.0;
                  
                    for (let j = 0; j < step; j++) {
                        const value = data[i * step + j];
                      
                        if (value < min) min = value;
                        if (value > max) max = value;
                    }
                  
                    context.lineTo(i, (1 + min) * amp);
                    context.lineTo(i, (1 + max) * amp);
                }
              
                context.lineTo(width, amp);
                context.stroke();
            }
        });
    </script>

</body>
</html>
